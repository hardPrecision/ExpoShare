{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/upload.css') }}">
{% endblock %}

{% block content %}
<div class="editor-wrapper">
    <div class="editor-card">
        <h1 class="editor-title">Редактор макета</h1>
        <form class="editor-form" method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}

            <div>
                <label for="exhibition_name" class="form-label">Название макета</label>
                {{ form.name(class="form-input", id="exhibition_name") }}
            </div>

            <div>
                <label for="exhibition_description" class="form-label">Описание макета</label>
                {{ form.description(class="form-input", id="exhibition_description", rows="3") }}
            </div>

            <div>
                <label for="exhibition_file" class="form-label">Прикрепленный файл</label>
                {{ form.file(class="form-input", id="exhibition_file") }}
                <div id="file-preview" class="file-preview"></div>
            </div>

            <div>
                {{ form.submit(class="btn-submit", value="Сохранить макет") }}
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const fileInput = document.getElementById('exhibition_file');
    const previewContainer = document.getElementById('file-preview');

    if (!fileInput || !previewContainer) return;

    fileInput.addEventListener('change', function (event) {
        previewContainer.innerHTML = '';
        const file = event.target.files[0];
        if (!file) return;

        const ext = file.name.split('.').pop().toLowerCase();
        if (['png', 'jpg', 'jpeg', 'gif'].includes(ext)) {
            const img = document.createElement('img');
            img.classList.add('file-preview-image');
            img.src = URL.createObjectURL(file);
            previewContainer.appendChild(img);
        } else {
            const span = document.createElement('span');
            span.textContent = file.name;
            previewContainer.appendChild(span);
        }
    });
});
</script>
{% endblock %}
